---
title: 01-测试
createTime: 2024/09/14 18:15:07
permalink: /notes/前端学习记录/ufuny1jd/


tags:
    - java
---


#  MyBatis 使用教程

## 本章重点：

- 框架概述
- JDBC 技术的缺点
- mybatis 介绍
- mybatis 使用
## 1.内容概述

- `MyBatis` 框架介绍

`MyBatis` 是一个流行的 `Java` 持久层框架，它简化了与关系型数据库的交互。通过将 `SQL` 语句与 `Java` 代码进行映射，`MyBatis` 提供了一种方便、灵活的方式来执行数据库操作。它支持动态`SQL`、缓存机制和插件扩展，使得开发人员能够更高效地编写和管理数据库访问代码。作为一种轻量级框架，`MyBatis` 在 `Java` 开发中被广泛应用于构建可靠的持久化解决方案。

- `你知道什么是SSM吗？`

拓展知识：在我们日常生活中实践中常用的 `SSM` 三层架构其实就是 `Spring`、`Spring MVC`和`MyBatis`这三个核心框架的简称。

> 本文将会指导你如何快速整合 `MyBatis`。


- 整合`MyBatis`的步骤？

![Spring整合MyBatis实现步骤](https://files.mdnice.com/user/57986/25d531cb-eee6-4bdd-99f0-ef434e32e767.png)

>`https://mybatis.net.cn/configuration.html`

![](https://files.mdnice.com/user/57986/da04d82c-80a0-4ed8-a545-81fa267e6ecb.png)

- 项目开发版本
> **框架版本：**
>
> - MySQL->8
> - JDK -> 17
> - MyBatis -> 3.5.15
> - junit -> 4.13.2

![MVC 架构中三个核心组件的关系：MVC模式示意图](https://files.mdnice.com/user/57986/5b3db71b-129e-476c-a930-bf10f75175b2.png)


![](https://files.mdnice.com/user/57986/e10b2f0c-1fac-4c27-bb83-3b2892f2e82f.png)


> **SpringMVC 核心思想**

> 在 `Spring MVC` 框架中，`Model` 层一般使用普通的 `Service Bean` 对象，`View` 层目前常用的是一些前端框架，以实现更好的渲染效果，`Controller` 是由 `Spring MVC` 特殊配置过的 `Servlet`，它会将用户请求分发给 `Model`，将响应转发给 `View`。


![](https://files.mdnice.com/user/57986/cd7e442b-0758-4f7d-939c-5c6bd3795d5a.png)

> 本节内容这部分不过多概述，后续再详细了解。

>**参考教程：**

- [Spring 整合 MyBatis的实现步骤](http://www.tianshouzhi.com/api/tutorials/mybatis/392)

- [3.0 mybatis与spring整合](http://www.tianshouzhi.com/api/tutorials/mybatis/392)

- [Mybatis教程-实战看这一篇就够了](https://www.cnblogs.com/diffx/p/10611082.html)

## 2.为什么需要 mybatis

### 2.1 传统JDBC 数据库处理流程繁琐
```java
package com.example.utils;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

/**
 * 功能：为了阐述JDBC 连接和mybatis连接方式过程当中主要区别
 * 作者：兮和
 * 时间： 11:49
 */
public class JdbcTest {
    public static void main(String[] args) throws Exception {
        Connection connection = null;
        PreparedStatement prepareStatement = null;
        ResultSet rs = null;

        try {
            // 加载驱动
            Class.forName("com.mysql.cj.jdbc.Driver");
            // 获取连接
            String url = "jdbc:mysql://127.0.0.1:3306/mybatis";
            String user = "root";
            String password = "root";
            connection = DriverManager.getConnection(url, user, password);
            // 获取statement，preparedStatement
            String sql = "select * from user where id=?";
            prepareStatement = connection.prepareStatement(sql);
            // 设置参数
            prepareStatement.setLong(1, 1l);
            // 执行查询
            rs = prepareStatement.executeQuery();
            // 处理结果集
            while (rs.next()) {
                System.out.println(rs.getString("user_name"));
                System.out.println(rs.getString("name"));
                System.out.println(rs.getInt("age"));
                System.out.println(rs.getDate("birthday"));
            }
        } finally {
            // 关闭连接，释放资源
            if (rs != null) {
                rs.close();
            }
            if (prepareStatement != null) {
                prepareStatement.close();
            }
            if (connection != null) {
                connection.close();
            }
        }
    }
}
```


![JDBC连接运行结果](https://files.mdnice.com/user/57986/b437ce4d-6157-4074-b73c-826ddf09a9a8.png)


![JDBC缺点分析](https://files.mdnice.com/user/57986/72d43404-22e7-4bc2-9766-bcc182632b0c.png)

### 2.2 MyBatis 框架有效解决了上述问题

MyBatis `避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。`MyBatis 可以使用简单的 XML 或注解来配置和映射原生类型、接口和 Java 的 POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。MyBatis是对JDBC的封装。相对于JDBC，MyBatis有以下优点：

- **SQL统一管理，对数据库进行存取操作。**

我们使用JDBC对数据库进行操作时，SQL查询语句分布在各个Java类中，这样可读性差，不利于维护，当我们修改Java类中的SQL语句时要重新进行编译。Mybatis可以把SQL语句放在配置文件中统一进行管理，以后修改配置文件，也不需要重新就行编译部署。

- **生成动态SQL语句。**

我们在查询中可能需要根据一些属性进行组合查询，比如我们进行商品查询，我们可以根据商品名称进行查询，也可以根据发货地进行查询，或者两者组合查询。如果使用JDBC进行查询，这样就需要写多条SQL语句。Mybatis可以在配置文件中通过使用<if test=””></if>标签进行SQL语句的拼接，生成动态SQL语句。

- **能够对结果集进行映射。**

我们在使用JDBC进行查询时，返回一个结果集ResultSet，我们要从结果集中取出结果封装为需要的类型。在Mybatis中，我们可以设置将结果直接映射为自己需要的类型，比如：JavaBean对象、一个Map、一个List等等。

### 2.3 MyBatis 框架结构
![Mybaits整体架构](https://files.mdnice.com/user/57986/87e2be86-4f31-4ec4-98c0-44ced6b8fc1e.png)


![框架概述](https://files.mdnice.com/user/57986/fbf83c4d-1860-44c3-8a41-76958e31b019.png)

![](https://files.mdnice.com/user/57986/2252715a-4ea3-443e-99f2-212f1a7810bf.png)

## 3.创建数据库

```sql
# 1.创建数据库
CREATE DATABASE IF NOT EXISTS mybatis;
# 2.使用当前数据库
USE mybatis;

# 3.创建表

DROP TABLE IF EXISTS user;
CREATE TABLE user
(
    id        char(32) NOT NULL,
    user_name varchar(32) DEFAULT NULL,
    password  varchar(32) DEFAULT NULL,
    name      varchar(32) DEFAULT NULL,
    age       int(10)     DEFAULT NULL,
    sex       int(2)      DEFAULT NULL,
    birthday  date        DEFAULT NULL,
    created   datetime    DEFAULT NULL,
    updated   datetime    DEFAULT NULL,
    PRIMARY KEY (id)
) ENGINE = InnoDB
  DEFAULT CHARSET = utf8;

# 4.插入数据用于测试

INSERT INTO mybatis.user (id, user_name, password, name, age, sex, birthday, created, updated)
VALUES (1, 'zpc', '123456', '鹏程', '22', '1', '1990-09-02', sysdate(), sysdate());
INSERT INTO mybatis.user (id, user_name, password, name, age, sex, birthday, created, updated)
VALUES (2, 'hj', '123456', '静静', '22', '1', '1993-09-05', sysdate(), sysdate());


```

## 4.创建Maven工程


![](https://files.mdnice.com/user/57986/ef5431b4-86fe-4e76-a9fb-7156dec9710e.png)


## 5.快速入门

```shell
├─src
│  ├─main
│  │  ├─java
│  │  │  └─com
│  │  │      └─example
│  │  │          ├─pojo
│  │  │          └─utils
│  │  └─resources
│  │      ├─mappers
│  │      └─sql

```


![](https://files.mdnice.com/user/57986/24c60cb0-1be0-4c7c-88c9-17988dcb3101.png)


### 5.1 引入项目依赖

- **pom.xml**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.example</groupId>
    <artifactId>mybatis</artifactId>
    <version>1.0-SNAPSHOT</version>

    <properties>
        <maven.compiler.source>17</maven.compiler.source>
        <maven.compiler.target>17</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    </properties>

    <!--    导入依赖    -->
    <dependencies>
        <!--mysql驱动-->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>8.0.33</version>
        </dependency>
        <!--mybatis驱动-->
        <dependency>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis</artifactId>
            <version>3.5.15</version>
        </dependency>
        <!--junit测试-->
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.13.2</version>
            <scope>test</scope>
        </dependency>
        <!-- druid数据源 -->
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid</artifactId>
            <version>1.2.20</version>
        </dependency>
    </dependencies>

</project>

```

### 5.2 全局配置文件

>**MySQL不同版本的注意事项**

1、驱动类driver-class-name
- MySQL 5版本使用jdbc5驱动，驱动类使用：`com.mysql.jdbc.Driver`
- MySQL 8版本使用jdbc8驱动，驱动类使用：`com.mysql.cj.jdbc.Driver`

2、连接地址url

- MySQL 5版本的url：`jdbc:mysql://localhost:3306/mybatis`
- MySQL 8版本的url：`jdbc:mysql://localhost:3306/mybatis?serverTimezone=UTC`
- 否则运行测试用例报告如下错误：
```
java.sql.SQLException: The server time zone value '*****' is unrecognized or
represents more
```

```xml
//mybatis-config.xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<!-- 根标签 -->
<configuration>
    <properties>
        <property name="driver" value="com.mysql.jdbc.Driver"/>
        <property name="url"
                  value="jdbc:mysql://127.0.0.1:3306/mybatis-110?useUnicode=true&amp;characterEncoding=utf-8&amp;allowMultiQueries=true"/>
        <property name="username" value="root"/>
        <property name="password" value="root"/>
    </properties>

    <!-- 环境，可以配置多个，default：指定采用哪个环境 -->
    <environments default="test">
        <!-- id：唯一标识 -->
        <environment id="test">
            <!-- 事务管理器，JDBC类型的事务管理器 -->
            <transactionManager type="JDBC"/>
            <!-- 数据源，池类型的数据源 -->
            <dataSource type="POOLED">
                <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
                <property name="url" value="jdbc:mysql://127.0.0.1:3306/mybatis"/>
                <property name="username" value="root"/>
                <property name="password" value="root"/>
            </dataSource>
        </environment>
        <environment id="development">
            <!-- 事务管理器，JDBC类型的事务管理器 -->
            <transactionManager type="JDBC"/>
            <!-- 数据源，池类型的数据源 -->
            <dataSource type="POOLED">
                <property name="driver" value="${driver}"/> <!-- 配置了properties，所以可以直接引用 -->
                <property name="url" value="${url}"/>
                <property name="username" value="${username}"/>
                <property name="password" value="${password}"/>
            </dataSource>
        </environment>
    </environments>
    <mappers>
        <mapper resource="mappers/MyMapper.xml"/>
    </mappers>
</configuration>
```

### 5.3 配置 MyMapper.xml

>核心配置文件主要用于配置连接数据库的环境以及MyBatis的全局配置信息。核心配置文件存放的位置是`src/main/resources`目录下
```xml
// MyMapper.xml

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- mapper:根标签，namespace：命名空间，随便写，一般保证命名空间唯一 -->
<mapper namespace="MyMapper">
    <!-- statement，内容：sql语句。id：唯一标识，随便写，在同一个命名空间下保持唯一
       resultType：sql语句查询结果集的封装类型,tb_user即为数据库中的表
     -->
    <select id="selectUser" resultType="com.example.pojo.User">
        select * from user where id = #{id}
    </select>
</mapper>
```

### 5.4 创建实体类User

```java
package com.example.pojo;

import java.util.Date;

/**
 * 功能：
 * 作者：兮和
 * 时间： 11:48
 */
public class User {
    private String id;
    private String user_name;
    private String password;
    private String name;
    private Integer age;
    private Integer sex;
    private Date birthday;
    private String created;
    private String updated;

    // getter 和 setter方法

    public String getId() {
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }

    public String getUser_name() {
        return user_name;
    }

    public void setUser_name(String user_name) {
        this.user_name = user_name;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    public Integer getSex() {
        return sex;
    }

    public void setSex(Integer sex) {
        this.sex = sex;
    }

    public Date getBirthday() {
        return birthday;
    }

    public void setBirthday(Date birthday) {
        this.birthday = birthday;
    }

    public String getCreated() {
        return created;
    }

    public void setCreated(String created) {
        this.created = created;
    }

    public String getUpdated() {
        return updated;
    }

    public void setUpdated(String updated) {
        this.updated = updated;
    }

    // toString

    @Override
    public String toString() {
        return "User{" +
                "id='" + id + '\'' +
                ", user_name='" + user_name + '\'' +
                ", password='" + password + '\'' +
                ", name='" + name + '\'' +
                ", age=" + age +
                ", sex=" + sex +
                ", birthday=" + birthday +
                ", created='" + created + '\'' +
                ", updated='" + updated + '\'' +
                '}';
    }
}
```

### 5.4 测试项目功能

```java
//MyBatisTest.java
package com.example.utils;

import com.example.pojo.User;
import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import java.io.InputStream;

/**
 * 功能：
 * 作者：兮和
 * 时间： 11:59
 */
public class MyBatisTest {
    public static void main(String[] args) throws Exception {
        // 指定全局配置文件
        String resource = "mybatis-config.xml";
        // 读取配置文件
        InputStream inputStream = Resources.getResourceAsStream(resource);
        // 构建sqlSessionFactory
        SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
        // 获取sqlSession
        SqlSession sqlSession = sqlSessionFactory.openSession();
        try {
            // 操作CRUD，第一个参数：指定statement，规则：命名空间+“.”+statementId
            // 第二个参数：指定传入sql的参数：这里是用户id
            User user = sqlSession.selectOne("MyMapper.selectUser", 1);
            System.out.println(user);
        } finally {
            sqlSession.close();
        }
    }
}

```


![测试结果](https://files.mdnice.com/user/57986/0f92afa0-b541-4f61-b126-7f9367a6cdec.png)
